package src.dptest;

/**
 * ç»™ä½ ä¸?ä¸ªæ•´æ•°æ•°ç»„Â numsÂ ã€‚å¦‚æœÂ numsÂ çš„ä¸€ä¸ªå­é›†ä¸­ï¼Œæ‰€æœ‰å…ƒç´ çš„ä¹˜ç§¯å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªæˆ–å¤šä¸ª äº’ä¸ç›¸åŒçš„è´¨æ•? çš„ä¹˜ç§¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°å®ƒä¸ºÂ å¥½å­é›†Â ã€?
 * æ¯”æ–¹è¯´ï¼Œå¦‚æœÂ nums = [1, 2, 3, 4]Â ï¼?
 * [2, 3]Â ï¼Œ[1, 2, 3]Â å’ŒÂ [1, 3]Â æ˜? å¥½Â å­é›†ï¼Œä¹˜ç§¯åˆ†åˆ«ä¸ºÂ?6 = 2*3Â ï¼?6 = 2*3Â å’ŒÂ?3 = 3Â ã€?
 * [1, 4] å’ŒÂ [4]Â ä¸æ˜¯ å¥½Â å­é›†ï¼Œå› ä¸ºä¹˜ç§¯åˆ†åˆ«ä¸ºÂ?4 = 2*2 å’ŒÂ?4 = 2*2Â ã€?
 * è¯·ä½ è¿”å› numsÂ ä¸­ä¸åŒçš„Â å¥½Â å­é›†çš„æ•°ç›®å¯¹Â?109 + 7Â å–ä½™Â çš„ç»“æœã??
 * numsÂ ä¸­çš„ å­é›†Â æ˜¯é?šè¿‡åˆ é™¤ numsÂ ä¸­ä¸€äº›ï¼ˆå¯èƒ½ä¸?ä¸ªéƒ½ä¸åˆ é™¤ï¼Œä¹Ÿå¯èƒ½å…¨éƒ¨éƒ½åˆ é™¤ï¼‰å…ƒç´ åå‰©ä½™å…ƒç´ ç»„æˆçš„æ•°ç»„ã??
 * å¦‚æœä¸¤ä¸ªå­é›†åˆ é™¤çš„ä¸‹æ ‡ä¸åŒï¼Œé‚£ä¹ˆå®ƒä»¬è¢«è§†ä¸ºä¸åŒçš„å­é›†ã€?
 * é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/the-number-of-good-subsets
 * @author Dreihunde
 *
 */
public class NumberOfGoodSubSets {
	//method 1 çŠ¶æ?å‹ç¼©dp O(n + C*2^(P)) O(2^(P)) Cä¸ºæ•°å­—èŒƒå›? Pä¸ºè´¨æ•°ä¸ªæ•?
    int MOD = (int)1e9+7;
    int[] p = new int[]{2, 3, 5, 7, 11, 13, 17, 19, 23, 29};
    int[] cnts = new int[35];
    public int numberOfGoodSubsets(int[] nums) {
        int n = nums.length;
        for (int i : nums) cnts[i]++;
        int mask = 1 << 10;
        //f[5]  5 äºŒè¿›åˆ¶ä½ 0000000101, è¡¨ç¤ºå­é›†æ‰?æœ‰å…ƒç´ ä¹˜ç§¯ä¸º f[0] * f[2] = 2 * 5 çš„ä¸ªæ•?
        // åŠ¨æ?è½¬ç§»æ–¹å¼ä¸ºåœ¨å·²æœ‰çš„æƒ…å†µä¸‹å†å¢åŠ å…¶ä»–è´¨æ•°  (f[0] * f[2]) * f[2] = (2 * 5) * 3
        // æ³¨æ„è¿™é‡Œ dp ç”? int ä¼šæº¢å‡?
        long[] f = new long[mask];
        f[0] = 1;
        for (int i = 2; i <= 30; i++) {
            if (cnts[i] == 0) continue;
            // å¯? i è¿›è¡Œè¯•é™¤
            int cur = 0, x = i;
            boolean ok = true;
            for (int j = 0; j < 10; j++) {
                int t = p[j], c = 0;
                while (x % t == 0) {
                    cur |= (1 << j);
                    x /= t; c++;
                }
                // å¦‚æœ i èƒ½å¤Ÿè¢«åŒä¸?è´¨æ•°è¯•é™¤å¤šæ¬¡ï¼Œè¯´æ˜? i ä¸èƒ½åŠ åˆ°å­é›†ï¼Œè·³è¿?
                if (c > 1) { 
                    ok = false;
                    break;
                }
            }
            if (!ok) continue;
            // æšä¸¾å‰ä¸€çŠ¶æ?? prev
            //ï¼ˆç¡®ä¿è?ƒè™‘ä¸?ä¸ªæ–°æ•°å?? i æ—¶ï¼Œä¾èµ–çš„å­é›? prev å­˜å‚¨çš„ä¸ºå°šæœªè€ƒè™‘ i çš„æ–¹æ¡ˆæ•°ï¼?
            for (int prev = mask - 1; prev >= 0; prev--) {
                // åªæœ‰å½“å‰é€‰æ‹©æ•°ä¸å‰ä¸€çŠ¶æ?ä¸å†²çªï¼Œåˆ™èƒ½å¤Ÿè¿›è¡Œè½¬ç§»ï¼Œå°†æ–¹æ¡ˆæ•°è¿›è¡Œç´¯åŠ?
                if ((prev & cur) != 0) continue;
                f[prev | cur] = (f[prev | cur] + f[prev] * cnts[i]) % MOD;
            }
        }
        long ans = 0;
        // ç»Ÿè®¡æ‰?æœ‰éç©ºé›†çš„æ–¹æ¡ˆæ•°
        for (int i = 1; i < mask; i++) ans = (ans + f[i]) % MOD;
        // åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè€ƒè™‘æ¯ä¸ª 1 é€‰æ‹©ä¸å¦å¯¹ç­”æ¡ˆçš„å½±å“
        for (int i = 0; i < cnts[1]; i++) ans = ans * 2 % MOD;
        return (int) ans;
    }

	public static void main(String[] args) {
		// TODO Auto-generated method stub

	}

}
